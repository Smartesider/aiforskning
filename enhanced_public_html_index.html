<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' https://skyforskning.no;">
    <title>AI Ethics Testing Framework - Landing Page</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-2xl text-blue-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-800">AI Ethics Framework</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button v-if="!isLoggedIn" @click="showLogin = true" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </button>
                        <button v-if="isLoggedIn" @click="logout" 
                                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white py-20">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h1 class="text-4xl md:text-6xl font-bold mb-6">AI Ethics Testing Framework</h1>
                <p class="text-xl md:text-2xl mb-8">Revolutionary AI Bias Detection & Monitoring System</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-brain text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Comprehensive Analysis</h3>
                        <p>Real-time monitoring of AI language models across 10 bias categories</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Advanced Detection</h3>
                        <p>150+ sophisticated questions testing political, gender, racial, and cultural bias</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-chart-line text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Transparent Reporting</h3>
                        <p>Public dashboard with real AI performance data and bias scores</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Testing Section -->
        <div class="max-w-7xl mx-auto px-4 py-16">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Live AI Bias Testing Dashboard</h2>
            
            <!-- Real-time Data Status -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Real-time Data Verification</h3>
                        <p class="text-sm text-gray-600">Last system update: {{ lastSystemUpdate }}</p>
                        <p class="text-xs text-green-600">‚úì Live data - Updated every 15 minutes</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-green-600">{{ totalTestsToday }}</div>
                        <div class="text-sm text-gray-600">Tests completed today</div>
                    </div>
                </div>
            </div>

            <!-- ‚úÖ NEW: Data Validation Warnings -->
            <div v-if="dataValidationAlerts.length > 0 || missingDataModels.length > 0 || dataInconsistencies.length > 0" class="mb-8">
                <!-- Missing Data Alert -->
                <div v-if="missingDataModels.length > 0" class="bg-amber-50 border-l-4 border-amber-400 p-4 mb-4 rounded-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-amber-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-amber-700">
                                <strong>‚ö†Ô∏è Data Completeness Notice:</strong> 
                                <span v-for="(model, index) in missingDataModels" :key="model">
                                    Missing data for {{ model }} so user do not think it scores that poorly{{ index < missingDataModels.length - 1 ? ', ' : '.' }}
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Inconsistency Warning -->
                <div v-if="dataInconsistencies.length > 0" class="bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-circle text-red-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-red-700">
                                <strong>üî¥ ‚ö†Ô∏è Data Inconsistency Warning:</strong> 
                                Large discrepancies detected between charts for: 
                                <span v-for="(inc, index) in dataInconsistencies" :key="inc.model">
                                    {{ inc.model }} (Œî{{ inc.difference.toFixed(1) }}){{ index < dataInconsistencies.length - 1 ? ', ' : '' }}
                                </span>
                            </p>
                            <button @click="showDataInconsistencyDialog = true" class="mt-2 text-xs text-red-600 hover:text-red-800 underline">
                                Show details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- LLM Status Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div v-for="model in llmStatus" :key="model.name" 
                     class="bg-white rounded-xl shadow-lg p-6 border-l-4"
                     :class="[
                         model.status === 'active' ? 'border-green-500' : 'border-red-500',
                         missingDataModels.includes(model.name) ? 'opacity-75' : '',
                         dataInconsistencies.some(inc => inc.model === model.name) ? 'ring-2 ring-red-300' : ''
                     ]">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-gray-800 flex items-center">
                            {{ model.name }}
                            <i v-if="missingDataModels.includes(model.name)" 
                               class="fas fa-exclamation-triangle text-amber-500 ml-2 text-sm" 
                               title="Missing data for this model so user do not think it scores that poorly"></i>
                            <span v-if="dataInconsistencies.some(inc => inc.model === model.name)" 
                                  class="ml-2 text-xs text-red-600 font-medium">(‚ö†Ô∏è)</span>
                        </h3>
                        <span :class="['px-2 py-1 text-xs rounded-full', 
                                     model.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800']">
                            {{ model.status }}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Run:</span>
                            <span class="font-medium">{{ model.lastRun }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Questions Answered:</span>
                            <span class="font-medium">{{ model.questionsAnswered }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Bias Score:</span>
                            <span :class="['font-medium', getBiasScoreColor(model.biasScore)]">{{ model.biasScore }}/100</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Red Flags Detection -->
            <div v-if="redFlags.length > 0" class="bg-red-50 border border-red-200 rounded-xl p-6 mb-8">
                <h3 class="text-lg font-bold text-red-800 mb-4">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Critical Bias Alerts Detected
                </h3>
                <ul class="space-y-2">
                    <li v-for="flag in redFlags" :key="flag.id" class="text-red-700">
                        <strong>RED FLAG:</strong> {{ flag.model }} returned unwanted information about {{ flag.topic }}: {{ flag.description }}
                    </li>
                </ul>
            </div>

            <!-- Advanced Analytics Section -->
            <div class="mt-16">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Advanced AI Ethics Analytics</h2>
                
                <!-- Chart 1: Multi-LLM Bias Trend Timeline with Validation -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-chart-line text-blue-600 mr-2"></i>Multi-LLM Bias Trend Timeline
                        </h3>
                        <div class="text-sm text-gray-600">
                            Updated every {{ chartUpdateDays }} days | Last update: {{ lastChartUpdate }}
                        </div>
                    </div>
                    <div class="h-80">
                        <canvas id="biasTimelineChart" class="w-full h-full"></canvas>
                    </div>
                    <!-- ‚úÖ Enhanced Model Legend with Validation Styling -->
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span v-for="model in chartData.models" :key="model.name" 
                              :class="[
                                  'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium',
                                  missingDataModels.includes(model.name) ? 'opacity-50' : 'opacity-100',
                                  dataInconsistencies.some(inc => inc.model === model.name) ? 'ring-2 ring-red-400' : ''
                              ]"
                              :style="`background-color: ${model.color}20; color: ${model.color}`">
                            <span class="w-2 h-2 rounded-full mr-2" 
                                  :style="`background-color: ${dataInconsistencies.some(inc => inc.model === model.name) ? '#ef4444' : model.color}`"></span>
                            {{ model.name }}
                            <i v-if="missingDataModels.includes(model.name)" 
                               class="fas fa-exclamation-triangle text-amber-500 ml-1 text-xs" 
                               title="Missing data for this model so user do not think it scores that poorly"></i>
                            <span v-if="dataInconsistencies.some(inc => inc.model === model.name)" 
                                  class="ml-1 text-red-500 text-xs">(‚ö†Ô∏è)</span>
                        </span>
                    </div>
                    <!-- ‚úÖ Chart Legend for Validation -->
                    <div v-if="dataValidationAlerts.length > 0" class="mt-4 pt-4 border-t border-gray-200">
                        <div class="text-xs text-gray-600 mb-2 font-medium">Chart Legend:</div>
                        <div class="flex flex-wrap gap-4 text-xs">
                            <div class="flex items-center">
                                <div class="w-4 h-0.5 bg-blue-500 mr-2"></div>
                                <span>Normal data</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-0.5 bg-blue-300 mr-2 border-dashed border-b"></div>
                                <span>Missing data</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-red-500 rounded-full mr-2"></div>
                                <span>Data inconsistency</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart 4: Category-Specific Performance Radar with Validation -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-radar text-indigo-600 mr-2"></i>Category-Specific Performance Radar
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="h-80">
                            <canvas id="radarChart" class="w-full h-full"></canvas>
                        </div>
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-800">Model Comparison</h4>
                            <!-- ‚úÖ Enhanced Model Comparison with Validation Styling -->
                            <div v-for="model in radarChartData.models" :key="model.name" 
                                 :class="[
                                     'flex items-center justify-between p-3 rounded-lg',
                                     missingDataModels.includes(model.name) ? 'bg-gray-50 opacity-50' : 'bg-gray-50',
                                     dataInconsistencies.some(inc => inc.model === model.name) ? 'border-2 border-red-200' : ''
                                 ]">
                                <div class="flex items-center">
                                    <div class="w-4 h-4 rounded-full mr-3" :style="`background-color: ${model.color}`"></div>
                                    <span class="font-medium">{{ model.name }}</span>
                                    <i v-if="missingDataModels.includes(model.name)" 
                                       class="fas fa-exclamation-triangle text-amber-500 ml-2 text-sm" 
                                       title="Missing data for this model so user do not think it scores that poorly"></i>
                                    <span v-if="dataInconsistencies.some(inc => inc.model === model.name)" 
                                          class="ml-2 text-xs text-red-600 font-medium">(‚ö†Ô∏è Inconsistent)</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    Avg Score: {{ model.avgScore || 'N/A' }}/100
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚úÖ Data Inconsistency Detail Dialog -->
        <div v-if="showDataInconsistencyDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                        Data Inconsistency Details
                    </h3>
                    <button @click="showDataInconsistencyDialog = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-semibold text-red-800 mb-2">Score Inconsistencies Detected</h4>
                        <div class="space-y-3">
                            <div v-for="inconsistency in dataInconsistencies" :key="inconsistency.model" 
                                 class="bg-white border border-red-200 rounded p-3">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-800">{{ inconsistency.model }}</span>
                                    <span class="text-sm text-red-600 font-bold">Œî{{ inconsistency.difference.toFixed(1) }}</span>
                                </div>
                                <div class="mt-2 text-sm text-gray-600">
                                    <div class="flex justify-between">
                                        <span>Timeline Score:</span>
                                        <span class="font-medium">{{ inconsistency.timelineScore.toFixed(1) }}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Radar Average:</span>
                                        <span class="font-medium">{{ inconsistency.radarScore.toFixed(1) }}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-6">
                    <button @click="showDataInconsistencyDialog = false" 
                            class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div v-if="showLogin" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Login</h3>
                    <button @click="showLogin = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="login">
                    <div class="mb-4">
                        <label for="ai-ethics-username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input v-model="loginForm.username" 
                               id="ai-ethics-username"
                               name="ai-ethics-username"
                               type="text" 
                               required
                               autocomplete="username"
                               data-lpignore="false"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label for="ai-ethics-password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input v-model="loginForm.password" 
                               id="ai-ethics-password"
                               name="ai-ethics-password"
                               type="password" 
                               required
                               autocomplete="current-password"
                               data-lpignore="false"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" @click="showLogin = false" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                        <button type="submit" :disabled="isLoggingIn"
                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg">
                            {{ isLoggingIn ? 'Logging in...' : 'Login' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    isLoggedIn: false,
                    showLogin: false,
                    isLoggingIn: false,
                    loginForm: { username: '', password: '' },
                    lastSystemUpdate: '',
                    totalTestsToday: 0,
                    llmStatus: [],
                    redFlags: [],
                    
                    // ‚úÖ Validation properties
                    dataValidationAlerts: [],
                    missingDataModels: [],
                    dataInconsistencies: [],
                    showDataInconsistencyDialog: false,
                    
                    // Chart data
                    chartUpdateDays: 7,
                    lastChartUpdate: new Date().toLocaleDateString(),
                    chartData: { models: [], timeline: [] },
                    radarChartData: { models: [] },
                    charts: {}
                }
            },
            mounted() {
                this.checkAuthStatus();
                this.loadSystemStatus();
                this.loadLLMStatus();
                this.loadRedFlags();
                this.loadChartData();
                
                // ‚úÖ Add validation data for demo
                this.addMockValidationData();
                
                setInterval(() => {
                    this.loadSystemStatus();
                    this.loadLLMStatus();
                    this.loadRedFlags();
                }, 300000);
            },
            methods: {
                async checkAuthStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/auth/status');
                        if (response.ok) {
                            const data = await response.json();
                            this.isLoggedIn = data.authenticated;
                        }
                    } catch (error) {
                        console.error('Auth status check failed:', error);
                    }
                },

                async login() {
                    this.isLoggingIn = true;
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        const data = await response.json();
                        if (response.ok) {
                            this.isLoggedIn = true;
                            this.showLogin = false;
                            this.loginForm = { username: '', password: '' };
                            if (data.role === 'admin') {
                                window.location.href = '/admin/';
                            } else {
                                window.location.href = '/bruker/';
                            }
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                    } finally {
                        this.isLoggingIn = false;
                    }
                },

                async logout() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        await fetch('https://skyforskning.no/api/v1/auth/logout', { method: 'POST' });
                        this.isLoggedIn = false;
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                },

                async loadSystemStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/system-status');
                        if (response.ok) {
                            const data = await response.json();
                            this.lastSystemUpdate = new Date().toLocaleString();
                            this.totalTestsToday = data.testsToday || 0;
                        }
                    } catch (error) {
                        console.error('Failed to load system status:', error);
                    }
                },

                async loadLLMStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/llm-status');
                        if (response.ok) {
                            const data = await response.json();
                            this.llmStatus = data.models || [];
                        }
                    } catch (error) {
                        console.error('Failed to load LLM status:', error);
                    }
                },

                async loadRedFlags() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/red-flags');
                        if (response.ok) {
                            const data = await response.json();
                            this.redFlags = data.flags || [];
                        }
                    } catch (error) {
                        console.error('Failed to load red flags:', error);
                    }
                },

                async loadChartData() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no/api/v1/chart-data');
                        const data = await response.json();
                        
                        this.chartData = data.timeline || { models: [], timeline: [] };
                        this.radarChartData = data.radar || { models: [] };
                        
                        // ‚úÖ VALIDATION: Check data completeness and consistency
                        this.validateAndProcessChartData();
                        
                        this.$nextTick(() => {
                            this.initializeCharts();
                        });
                    } catch (error) {
                        console.error('Failed to load chart data:', error);
                    }
                },

                // ‚úÖ VALIDATION METHODS
                validateAndProcessChartData() {
                    this.dataValidationAlerts = [];
                    this.missingDataModels = [];
                    this.dataInconsistencies = [];
                    
                    this.validateTimelineData();
                    this.validateRadarData();
                    this.crossCheckDataConsistency();
                },

                validateTimelineData() {
                    if (!this.chartData.models || this.chartData.models.length === 0) return;
                    
                    this.chartData.models.forEach(model => {
                        if (!model.biasScores || model.biasScores.length === 0) {
                            this.missingDataModels.push(model.name);
                            this.dataValidationAlerts.push({
                                type: 'warning',
                                message: `Missing data for ${model.name} so user do not think it scores that poorly.`,
                                model: model.name
                            });
                        }
                    });
                },

                validateRadarData() {
                    if (!this.radarChartData.models || this.radarChartData.models.length === 0) return;
                    
                    this.radarChartData.models.forEach(model => {
                        if (!model.scores || model.scores.length === 0) {
                            if (!this.missingDataModels.includes(model.name)) {
                                this.missingDataModels.push(model.name);
                            }
                        }
                    });
                },

                crossCheckDataConsistency() {
                    const timelineModels = this.chartData.models.map(m => m.name);
                    const radarModels = this.radarChartData.models.map(m => m.name);
                    const commonModels = timelineModels.filter(name => radarModels.includes(name));
                    
                    commonModels.forEach(modelName => {
                        const timelineModel = this.chartData.models.find(m => m.name === modelName);
                        const radarModel = this.radarChartData.models.find(m => m.name === modelName);
                        
                        if (timelineModel && radarModel && timelineModel.biasScores && radarModel.avgScore) {
                            const latestTimelineScore = timelineModel.biasScores[timelineModel.biasScores.length - 1];
                            const avgRadarScore = radarModel.avgScore;
                            const scoreDifference = Math.abs(latestTimelineScore - avgRadarScore);
                            
                            if (scoreDifference > 30) {
                                this.dataInconsistencies.push({
                                    model: modelName,
                                    timelineScore: latestTimelineScore,
                                    radarScore: avgRadarScore,
                                    difference: scoreDifference
                                });
                            }
                        }
                    });
                },

                initializeCharts() {
                    this.createBiasTimelineChart();
                    this.createRadarChart();
                },

                createBiasTimelineChart() {
                    const ctx = document.getElementById('biasTimelineChart');
                    if (!ctx || !this.chartData.models.length) return;

                    if (this.charts.biasTimeline) {
                        this.charts.biasTimeline.destroy();
                    }

                    // ‚úÖ Apply validation styling
                    const datasets = this.chartData.models.map(model => {
                        const isMissingData = this.missingDataModels.includes(model.name);
                        const hasInconsistency = this.dataInconsistencies.some(inc => inc.model === model.name);
                        
                        return {
                            label: model.name,
                            data: model.biasScores || [],
                            borderColor: isMissingData ? model.color + '60' : (hasInconsistency ? '#ef4444' : model.color),
                            backgroundColor: isMissingData ? model.color + '10' : (hasInconsistency ? '#ef444420' : model.color + '20'),
                            borderDash: isMissingData ? [8, 4] : [],
                            borderWidth: isMissingData ? 2 : (hasInconsistency ? 3 : 2),
                            pointRadius: hasInconsistency ? 8 : (isMissingData ? 6 : 4),
                            pointBackgroundColor: hasInconsistency ? '#ef4444' : (isMissingData ? model.color + '80' : model.color),
                            _isMissingData: isMissingData,
                            _hasInconsistency: hasInconsistency
                        };
                    });

                    this.charts.biasTimeline = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7'],
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const modelName = context.dataset.label;
                                            const value = context.parsed.y;
                                            const isMissing = context.dataset._isMissingData;
                                            const hasInconsistency = context.dataset._hasInconsistency;
                                            
                                            let label = `${modelName}: ${value.toFixed(1)}%`;
                                            if (isMissing) {
                                                label += ' - Missing data for this model so user do not think it scores that poorly';
                                            }
                                            if (hasInconsistency) {
                                                label += ' - ‚ö†Ô∏è Data inconsistency detected';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: { display: true, text: 'Bias Score (%)' }
                                }
                            }
                        }
                    });
                },

                createRadarChart() {
                    const ctx = document.getElementById('radarChart');
                    if (!ctx || !this.radarChartData.models.length) return;

                    if (this.charts.radar) {
                        this.charts.radar.destroy();
                    }

                    // ‚úÖ Apply validation styling
                    const datasets = this.radarChartData.models.slice(0, 5).map(model => {
                        const isMissingData = this.missingDataModels.includes(model.name);
                        const hasInconsistency = this.dataInconsistencies.some(inc => inc.model === model.name);
                        
                        return {
                            label: model.name,
                            data: model.scores || [],
                            borderColor: isMissingData ? model.color + '60' : (hasInconsistency ? '#ef4444' : model.color),
                            backgroundColor: isMissingData ? model.color + '10' : (hasInconsistency ? '#ef444410' : model.color + '20'),
                            pointBackgroundColor: hasInconsistency ? '#ef4444' : (isMissingData ? model.color + '80' : model.color),
                            pointRadius: hasInconsistency ? 8 : (isMissingData ? 5 : 4),
                            borderWidth: isMissingData ? 1 : (hasInconsistency ? 3 : 2),
                            _isMissingData: isMissingData,
                            _hasInconsistency: hasInconsistency
                        };
                    });

                    this.charts.radar = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['Political', 'Gender', 'Racial', 'Religious', 'Economic'],
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const modelName = context.dataset.label;
                                            const value = context.parsed.r;
                                            const isMissing = context.dataset._isMissingData;
                                            const hasInconsistency = context.dataset._hasInconsistency;
                                            
                                            let label = `${modelName}: ${value.toFixed(1)}%`;
                                            if (isMissing) {
                                                label += ' - Missing data for this model so user do not think it scores that poorly';
                                            }
                                            if (hasInconsistency) {
                                                label += ' - ‚ö†Ô∏è Data inconsistency detected';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: { callback: function(value) { return value + '%'; } }
                                }
                            }
                        }
                    });
                },

                getBiasScoreColor(score) {
                    if (score < 30) return 'text-green-600';
                    if (score < 70) return 'text-yellow-600';
                    return 'text-red-600';
                },

                getModelColor(index) {
                    const colors = ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#F97316'];
                    return colors[index % colors.length];
                },

                // ‚úÖ Mock data for demonstration
                addMockValidationData() {
                    this.missingDataModels = ['grok-test-bias', 'claude-test-bias'];
                    this.dataInconsistencies = [
                        { model: 'grok-test-bias', timelineScore: 85.0, radarScore: 39.8, difference: 45.2 }
                    ];
                    
                    this.chartData.models = [
                        { name: 'grok-test-bias', biasScores: [85.0, 82.3, 89.1], color: '#3B82F6' },
                        { name: 'claude-test-bias', biasScores: [72.0, 71.5, 73.2], color: '#EF4444' },
                        { name: 'gpt-4', biasScores: [45.2, 44.8, 46.1], color: '#F59E0B' }
                    ];
                    
                    this.radarChartData.models = [
                        { name: 'grok-test-bias', scores: [39.8, 42.1, 38.5, 41.2, 40.0], avgScore: 39.8, color: '#3B82F6' },
                        { name: 'claude-test-bias', scores: [39.9, 38.7, 41.2, 40.3, 39.1], avgScore: 39.9, color: '#EF4444' },
                        { name: 'gpt-4', scores: [45.0, 44.8, 45.5, 45.2, 44.9], avgScore: 45.1, color: '#F59E0B' }
                    ];
                    
                    this.llmStatus = [
                        { name: 'grok-test-bias', status: 'active', lastRun: '2 hours ago', questionsAnswered: 150, biasScore: 85 },
                        { name: 'claude-test-bias', status: 'active', lastRun: '1 hour ago', questionsAnswered: 150, biasScore: 72 },
                        { name: 'gpt-4', status: 'active', lastRun: '30 min ago', questionsAnswered: 150, biasScore: 45 }
                    ];
                    
                    this.$nextTick(() => {
                        this.initializeCharts();
                    });
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
