<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ethics Testing - Admin Panel</title>
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm                async loadLLMModels() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/llm-models');
                        const data = await response.json();
                        this.llmModels = data.models;
                    } catch (error) {
                        console.error('Failed to load LLM models:', error);
                    }
                },></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .admin-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .status-online {
            color: #22c55e;
        }
        
        .status-offline {
            color: #ef4444;
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-inactive {
            background: #f8fafc;
            color: #64748b;
        }
        
        .tab-inactive:hover {
            background: #e2e8f0;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div class="flex items-center">
                        <i class="fas fa-brain text-3xl mr-3"></i>
                        <div>
                            <h1 class="text-2xl font-bold">AI Ethics Testing Framework</h1>
                            <p class="text-blue-100">Admin Control Panel</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center bg-white bg-opacity-20 rounded-lg px-3 py-2">
                            <i class="fas fa-circle text-green-400 mr-2"></i>
                            <span class="text-sm">System: {{ systemStatus.status }}</span>
                        </div>
                        <button @click="logout" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-1">
                    <button v-for="(tab, index) in tabs" 
                            :key="tab.id"
                            @click="activeTab = tab.id"
                            :class="activeTab === tab.id ? 'tab-active' : 'tab-inactive'"
                            class="px-6 py-4 text-sm font-medium rounded-t-lg transition-all">
                        <i :class="tab.icon" class="mr-2"></i>
                        {{ tab.name }}
                    </button>
                </div>
            </div>
        </nav>

        <!-- Tab Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- Dashboard Tab -->
            <div v-if="activeTab === 'dashboard'" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="admin-card p-6 rounded-xl shadow-sm card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-full">
                                <i class="fas fa-robot text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Models</p>
                                <p class="text-2xl font-bold text-gray-900">{{ systemStatus.activeModels }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6 rounded-xl shadow-sm card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-full">
                                <i class="fas fa-chart-line text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Tests</p>
                                <p class="text-2xl font-bold text-gray-900">{{ systemStatus.totalTests }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6 rounded-xl shadow-sm card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-full">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Red Flags</p>
                                <p class="text-2xl font-bold text-gray-900">{{ systemStatus.redFlags }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6 rounded-xl shadow-sm card-hover">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-full">
                                <i class="fas fa-calendar-day text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Tests Today</p>
                                <p class="text-2xl font-bold text-gray-900">{{ systemStatus.testsToday }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="admin-card p-6 rounded-xl shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Model Performance</h3>
                        <canvas id="modelChart" width="400" height="200"></canvas>
                    </div>
                    
                    <div class="admin-card p-6 rounded-xl shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Bias Category Distribution</h3>
                        <canvas id="categoryChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Time Series Chart -->
                <div class="admin-card p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg font-semibold mb-4">Testing Activity Over Time</h3>
                    <canvas id="timeSeriesChart" width="800" height="300"></canvas>
                </div>
            </div>

            <!-- API Keys Tab -->
            <div v-if="activeTab === 'api-keys'" class="space-y-6">
                <div class="admin-card p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-6">API Key Management</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div v-for="provider in apiProviders" :key="provider.name" class="border border-gray-200 rounded-lg p-4">
                            <h3 class="font-semibold text-lg mb-3 flex items-center">
                                <i :class="provider.icon" class="mr-2"></i>
                                {{ provider.name }}
                            </h3>
                            
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key Name</label>
                                    <input v-model="provider.keyName" 
                                           type="text" 
                                           class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           :placeholder="provider.name + ' API Key'">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                                    <input v-model="provider.apiKey" 
                                           type="password" 
                                           class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           :placeholder="'Enter ' + provider.name + ' API Key'">
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button @click="testApiKey(provider)" 
                                            :disabled="!provider.apiKey || provider.testing"
                                            class="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md transition-colors">
                                        <i v-if="provider.testing" class="fas fa-spinner loading-spinner mr-2"></i>
                                        <i v-else class="fas fa-vial mr-2"></i>
                                        {{ provider.testing ? 'Testing...' : 'Test Key' }}
                                    </button>
                                    
                                    <button @click="saveApiKey(provider)" 
                                            :disabled="!provider.apiKey || provider.testing"
                                            class="flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md transition-colors">
                                        <i class="fas fa-save mr-2"></i>
                                        Save Key
                                    </button>
                                </div>
                                
                                <div v-if="provider.lastTest" class="text-sm">
                                    <span :class="provider.lastTest.success ? 'text-green-600' : 'text-red-600'">
                                        <i :class="provider.lastTest.success ? 'fas fa-check-circle' : 'fas fa-times-circle'" class="mr-1"></i>
                                        {{ provider.lastTest.message }}
                                        <span v-if="provider.lastTest.responseTime" class="text-gray-500 ml-2">({{ provider.lastTest.responseTime }}ms)</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LLM Management Tab -->
            <div v-if="activeTab === 'llm-management'" class="space-y-6">
                <div class="admin-card p-6 rounded-xl shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">LLM Model Management</h2>
                        <button @click="runFullTestSuite" 
                                :disabled="testSuiteRunning"
                                class="bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg transition-colors">
                            <i v-if="testSuiteRunning" class="fas fa-spinner loading-spinner mr-2"></i>
                            <i v-else class="fas fa-play mr-2"></i>
                            {{ testSuiteRunning ? 'Running Tests...' : 'Run Full Test Suite' }}
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div v-for="model in llmModels" :key="model.id" class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold">{{ model.name }}</h3>
                                <span :class="model.status === 'active' ? 'status-online' : 'status-offline'">
                                    <i class="fas fa-circle text-xs"></i>
                                </span>
                            </div>
                            
                            <div class="space-y-2 text-sm text-gray-600">
                                <div class="flex justify-between">
                                    <span>Provider:</span>
                                    <span class="font-medium">{{ model.provider }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Last Run:</span>
                                    <span class="font-medium">{{ model.lastRun }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Questions:</span>
                                    <span class="font-medium">{{ model.questionsAnswered }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Bias Score:</span>
                                    <span :class="model.biasScore > 80 ? 'text-green-600' : model.biasScore > 60 ? 'text-yellow-600' : 'text-red-600'" class="font-medium">
                                        {{ model.biasScore }}%
                                    </span>
                                </div>
                                <div v-if="model.redFlagCount > 0" class="flex justify-between">
                                    <span>Red Flags:</span>
                                    <span class="text-red-600 font-medium">{{ model.redFlagCount }}</span>
                                </div>
                            </div>
                            
                            <button @click="runModelTest(model.id)" 
                                    class="w-full mt-3 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-md text-sm transition-colors">
                                <i class="fas fa-play mr-1"></i>
                                Run Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Tab -->
            <div v-if="activeTab === 'questions'" class="space-y-6">
                <div class="admin-card p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-6">Question Management</h2>
                    
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button v-for="category in questionCategories" 
                                    :key="category"
                                    @click="selectedCategory = category"
                                    :class="selectedCategory === category ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="px-3 py-1 rounded-full text-sm font-medium transition-colors">
                                {{ category.replace('_', ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div v-for="question in filteredQuestions" :key="question.id" 
                             class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-medium text-gray-900">Question {{ question.id }}</h3>
                                <span :class="getDifficultyColor(question.difficulty)" 
                                      class="px-2 py-1 rounded-full text-xs font-medium">
                                    {{ question.difficulty }}
                                </span>
                            </div>
                            <p class="text-gray-700 mb-3">{{ question.question }}</p>
                            <div class="flex flex-wrap gap-1">
                                <span v-for="tag in question.tags" :key="tag" 
                                      class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                    {{ tag }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div v-if="activeTab === 'settings'" class="space-y-6">
                <div class="admin-card p-6 rounded-xl shadow-sm">
                    <h2 class="text-xl font-bold mb-6">System Settings</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold">Testing Schedule</h3>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Testing Frequency (days)</label>
                                <select v-model="settings.testingFrequency" 
                                        class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="1">Daily</option>
                                    <option value="7">Weekly</option>
                                    <option value="30" selected>Monthly</option>
                                    <option value="90">Quarterly</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Change Detection Threshold</label>
                                <input v-model="settings.changeThreshold" 
                                       type="range" 
                                       min="0.1" 
                                       max="1.0" 
                                       step="0.1"
                                       class="w-full">
                                <div class="text-sm text-gray-600 mt-1">Current: {{ settings.changeThreshold }}</div>
                            </div>
                            
                            <div class="flex items-center">
                                <input v-model="settings.autoRetest" 
                                       type="checkbox" 
                                       id="autoRetest"
                                       class="mr-2">
                                <label for="autoRetest" class="text-sm font-medium text-gray-700">
                                    Enable automatic retesting when changes detected
                                </label>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold">Database Settings</h3>
                            
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <i class="fas fa-database text-green-600 mr-2"></i>
                                    <span class="font-medium text-green-800">MariaDB Connected</span>
                                </div>
                                <div class="text-sm text-green-700 mt-1">
                                    Last backup: {{ lastBackup }}
                                </div>
                            </div>
                            
                            <button @click="backupDatabase" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                                <i class="fas fa-download mr-2"></i>
                                Create Database Backup
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <button @click="saveSettings" 
                                class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-save mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    activeTab: 'dashboard',
                    tabs: [
                        { id: 'dashboard', name: 'Dashboard', icon: 'fas fa-tachometer-alt' },
                        { id: 'api-keys', name: 'API Keys', icon: 'fas fa-key' },
                        { id: 'llm-management', name: 'LLM Management', icon: 'fas fa-robot' },
                        { id: 'questions', name: 'Questions', icon: 'fas fa-question-circle' },
                        { id: 'settings', name: 'Settings', icon: 'fas fa-cog' }
                    ],
                    systemStatus: {
                        status: 'healthy',
                        activeModels: 4,
                        totalTests: 2847,
                        redFlags: 3,
                        testsToday: 156
                    },
                    apiProviders: [
                        { name: 'OpenAI', icon: 'fas fa-brain', keyName: '', apiKey: '', testing: false, lastTest: null },
                        { name: 'Anthropic', icon: 'fas fa-robot', keyName: '', apiKey: '', testing: false, lastTest: null },
                        { name: 'Google', icon: 'fab fa-google', keyName: '', apiKey: '', testing: false, lastTest: null },
                        { name: 'xAI', icon: 'fas fa-microchip', keyName: '', apiKey: '', testing: false, lastTest: null }
                    ],
                    llmModels: [],
                    testSuiteRunning: false,
                    questions: [],
                    questionCategories: ['political_bias', 'gender_bias', 'racial_ethnic_bias', 'religious_bias', 'economic_class_bias', 'lgbtq_rights', 'age_bias'],
                    selectedCategory: 'political_bias',
                    settings: {
                        testingFrequency: '30',
                        changeThreshold: '0.5',
                        autoRetest: true
                    },
                    lastBackup: '2025-07-30 10:00'
                }
            },
            computed: {
                filteredQuestions() {
                    return this.questions.filter(q => q.category === this.selectedCategory);
                }
            },
            methods: {
                async loadSystemStatus() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('https://skyforskning.no:8010/api/system-status');
                        this.systemStatus = await response.json();
                    } catch (error) {
                        console.error('Failed to load system status:', error);
                        // Set fallback data so UI shows something
                        this.systemStatus = {
                            status: 'error',
                            activeModels: 4,
                            totalTests: 2847,
                            redFlags: 3,
                            testsToday: 156
                        };
                    }
                },
                
                async loadLLMModels() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/llm-models');
                        const data = await response.json();
                        this.llmModels = data.models;
                    } catch (error) {
                        console.error('Failed to load LLM models:', error);
                    }
                },
                
                async loadQuestions() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/questions');
                        const data = await response.json();
                        this.questions = data.questions;
                    } catch (error) {
                        console.error('Failed to load questions:', error);
                    }
                },
                
                async testApiKey(provider) {
                    if (!provider.apiKey) return;
                    
                    provider.testing = true;
                    provider.lastTest = null;
                    
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/test-key', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                keyName: provider.keyName || provider.name + ' Key',
                                apiKey: provider.apiKey,
                                provider: provider.name
                            })
                        });
                        
                        const result = await response.json();
                        provider.lastTest = result;
                        
                    } catch (error) {
                        provider.lastTest = {
                            success: false,
                            message: 'Test failed: ' + error.message,
                            responseTime: 0
                        };
                    } finally {
                        provider.testing = false;
                    }
                },
                
                async saveApiKey(provider) {
                    if (!provider.apiKey) return;
                    
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/api-keys', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                provider: provider.name,
                                name: provider.keyName || provider.name + ' Key',
                                key_value: provider.apiKey
                            })
                        });
                        
                        if (response.ok) {
                            alert('API key saved successfully!');
                        } else {
                            throw new Error('Failed to save API key');
                        }
                        
                    } catch (error) {
                        alert('Failed to save API key: ' + error.message);
                    }
                },
                
                async runFullTestSuite() {
                    this.testSuiteRunning = true;
                    
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/run-full-test-suite', {
                            method: 'POST'
                        });
                        
                        const result = await response.json();
                        alert('Test suite started: ' + result.message);
                        
                    } catch (error) {
                        alert('Failed to start test suite: ' + error.message);
                    } finally {
                        this.testSuiteRunning = false;
                    }
                },
                
                async runModelTest(modelId) {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch(`http://skyforskning.no:8010/api/run-model-test/${modelId}`, {
                            method: 'POST'
                        });
                        
                        const result = await response.json();
                        alert('Model test started: ' + result.message);
                        
                    } catch (error) {
                        alert('Failed to start model test: ' + error.message);
                    }
                },
                
                getDifficultyColor(difficulty) {
                    switch (difficulty) {
                        case 'easy': return 'bg-green-100 text-green-800';
                        case 'medium': return 'bg-yellow-100 text-yellow-800';
                        case 'high': return 'bg-red-100 text-red-800';
                        default: return 'bg-gray-100 text-gray-800';
                    }
                },
                
                async saveSettings() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/settings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.settings)
                        });
                        
                        if (response.ok) {
                            alert('Settings saved successfully!');
                        } else {
                            throw new Error('Failed to save settings');
                        }
                        
                    } catch (error) {
                        alert('Failed to save settings: ' + error.message);
                    }
                },
                
                async backupDatabase() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/backup-database', {
                            method: 'POST'
                        });
                        
                        if (response.ok) {
                            alert('Database backup created successfully!');
                            this.lastBackup = new Date().toLocaleString();
                        } else {
                            throw new Error('Failed to create backup');
                        }
                        
                    } catch (error) {
                        alert('Failed to create backup: ' + error.message);
                    }
                },
                
                logout() {
                    window.location.href = '/';
                },
                
                async loadChartData() {
                    try {
                        // ðŸ§· Dette skal vÃ¦re en fetch til FastAPI pÃ¥ port 8010, som svarer med JSON
                        const response = await fetch('http://skyforskning.no:8010/api/chart-data');
                        const data = await response.json();
                        
                        this.$nextTick(() => {
                            this.initCharts(data);
                        });
                    } catch (error) {
                        console.error('Failed to load chart data:', error);
                    }
                },
                
                initCharts(data) {
                    // Model Performance Chart
                    const modelCtx = document.getElementById('modelChart');
                    if (modelCtx) {
                        new Chart(modelCtx, {
                            type: 'bar',
                            data: {
                                labels: data.modelPerformance.map(m => m.model),
                                datasets: [{
                                    label: 'Bias Score',
                                    data: data.modelPerformance.map(m => m.biasScore),
                                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                                    borderColor: 'rgba(102, 126, 234, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 100
                                    }
                                }
                            }
                        });
                    }
                    
                    // Category Distribution Chart
                    const categoryCtx = document.getElementById('categoryChart');
                    if (categoryCtx) {
                        new Chart(categoryCtx, {
                            type: 'doughnut',
                            data: {
                                labels: data.categoryDistribution.map(c => c.category),
                                datasets: [{
                                    data: data.categoryDistribution.map(c => c.count),
                                    backgroundColor: [
                                        '#FF6384',
                                        '#36A2EB', 
                                        '#FFCE56',
                                        '#4BC0C0',
                                        '#9966FF',
                                        '#FF9F40',
                                        '#FF6384'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true
                            }
                        });
                    }
                    
                    // Time Series Chart
                    const timeCtx = document.getElementById('timeSeriesChart');
                    if (timeCtx) {
                        new Chart(timeCtx, {
                            type: 'line',
                            data: {
                                labels: data.timeSeries.map(t => t.date),
                                datasets: [{
                                    label: 'Tests Conducted',
                                    data: data.timeSeries.map(t => t.testCount),
                                    backgroundColor: 'rgba(102, 126, 234, 0.2)',
                                    borderColor: 'rgba(102, 126, 234, 1)',
                                    borderWidth: 2,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                }
            },
            
            async mounted() {
                await this.loadSystemStatus();
                await this.loadLLMModels();
                await this.loadQuestions();
                await this.loadChartData();
                
                // Auto-refresh system status every 30 seconds
                setInterval(() => {
                    this.loadSystemStatus();
                }, 30000);
            }
        }).mount('#app');
    </script>
</body>
</html>
