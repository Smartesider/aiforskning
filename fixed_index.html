<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ethics Testing Framework - Landing Page</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <i class="fas fa-shield-alt text-2xl text-blue-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-800">AI Ethics Framework</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button v-if="!isLoggedIn" @click="showLogin = true" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </button>
                        <button v-if="isLoggedIn" @click="logout" 
                                class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-700 text-white py-20">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h1 class="text-4xl md:text-6xl font-bold mb-6">AI Ethics Testing Framework</h1>
                <p class="text-xl md:text-2xl mb-8">Revolutionary AI Bias Detection & Monitoring System</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-brain text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Comprehensive Analysis</h3>
                        <p>Real-time monitoring of AI language models across 10 bias categories</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Advanced Detection</h3>
                        <p>150+ sophisticated questions testing political, gender, racial, and cultural bias</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6">
                        <i class="fas fa-chart-line text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Transparent Reporting</h3>
                        <p>Public dashboard with real AI performance data and bias scores</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Testing Section -->
        <div class="max-w-7xl mx-auto px-4 py-16">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">Live AI Bias Testing Dashboard</h2>
            
            <!-- Real-time Data Status -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Real-time Data Verification</h3>
                        <p class="text-sm text-gray-600">Last system update: {{ lastSystemUpdate }}</p>
                        <p class="text-xs text-green-600">‚úì Live data - Updated every 15 minutes</p>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-green-600">{{ totalTestsToday }}</div>
                        <div class="text-sm text-gray-600">Tests completed today</div>
                    </div>
                </div>
            </div>

            <!-- LLM Status Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div v-for="model in llmStatus" :key="model.name" 
                     class="bg-white rounded-xl shadow-lg p-6 border-l-4"
                     :class="model.status === 'active' ? 'border-green-500' : 'border-red-500'">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-gray-800">{{ model.name }}</h3>
                        <span :class="['px-2 py-1 text-xs rounded-full', 
                                     model.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800']">
                            {{ model.status }}
                        </span>
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Run:</span>
                            <span class="font-medium">{{ model.lastRun }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Questions Answered:</span>
                            <span class="font-medium">{{ model.questionsAnswered }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Bias Score:</span>
                            <span :class="['font-medium', getBiasScoreColor(model.biasScore)]">{{ model.biasScore }}/100</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Red Flags Detection -->
            <div v-if="redFlags.length > 0" class="bg-red-50 border border-red-200 rounded-xl p-6 mb-8">
                <h3 class="text-lg font-bold text-red-800 mb-4">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Critical Bias Alerts Detected
                </h3>
                <ul class="space-y-2">
                    <li v-for="flag in redFlags" :key="flag.id" class="text-red-700">
                        <strong>RED FLAG:</strong> {{ flag.model }} returned unwanted information about {{ flag.topic }}: {{ flag.description }}
                    </li>
                </ul>
            </div>
            
            <!-- Bias Categories -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                <div v-for="category in biasCategories" :key="category.id" 
                     @click="selectedCategory = category.id"
                     :class="['cursor-pointer p-4 rounded-xl border-2 transition-all', 
                              selectedCategory === category.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300']">
                    <div class="text-center">
                        <i :class="['text-2xl mb-2', category.icon]"></i>
                        <h3 class="font-semibold text-sm">{{ category.name }}</h3>
                        <div class="text-xs text-gray-600 mt-1">{{ category.questionCount }} questions</div>
                    </div>
                </div>
            </div>

            <!-- Current Question Display -->
            <div v-if="currentQuestion" class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="mb-4">
                    <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">
                        {{ getCurrentCategoryName() }}
                    </span>
                    <span class="ml-2 inline-block bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded">
                        {{ currentQuestion.difficulty }} difficulty
                    </span>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-4">{{ currentQuestion.question }}</h3>
                
                <!-- AI Model Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Test with AI Model:</label>
                    <select v-model="selectedModel" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">Select an AI model...</option>
                        <option v-for="model in availableModels" :key="model.id" :value="model.id">
                            {{ model.provider }} - {{ model.name }}
                        </option>
                    </select>
                </div>

                <!-- Test Button -->
                <div class="flex justify-between items-center">
                    <button @click="testQuestion" :disabled="!selectedModel || isLoading"
                            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-semibold">
                        <i v-if="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
                        <i v-else class="fas fa-play mr-2"></i>
                        {{ isLoading ? 'Testing...' : 'Test AI Response' }}
                    </button>
                    <button @click="nextQuestion" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                        <i class="fas fa-forward mr-2"></i>Next Question
                    </button>
                </div>
            </div>

            <!-- AI Response -->
            <div v-if="aiResponse" class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h4 class="text-lg font-bold text-gray-800 mb-4">AI Response</h4>
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <p class="text-gray-800">{{ aiResponse.content }}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <span class="font-semibold text-blue-800">Response Time:</span>
                        <div class="text-blue-600">{{ aiResponse.responseTime }}ms</div>
                    </div>
                    <div class="bg-green-50 p-3 rounded-lg">
                        <span class="font-semibold text-green-800">Bias Score:</span>
                        <div class="text-green-600">{{ aiResponse.biasScore }}/10</div>
                    </div>
                    <div class="bg-purple-50 p-3 rounded-lg">
                        <span class="font-semibold text-purple-800">Category:</span>
                        <div class="text-purple-600">{{ aiResponse.detectedBias }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div v-if="showLogin" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">Login</h3>
                    <button @click="showLogin = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form @submit.prevent="login">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input v-model="loginForm.username" type="text" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input v-model="loginForm.password" type="password" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" @click="showLogin = false" 
                                class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                        <button type="submit" :disabled="isLoggingIn"
                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg">
                            {{ isLoggingIn ? 'Logging in...' : 'Login' }}
                        </button>
                    </div>
                </form>
                <div v-if="loginError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                    <p class="text-red-800 text-sm">{{ loginError }}</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    isLoggedIn: false,
                    showLogin: false,
                    isLoggingIn: false,
                    loginError: '',
                    loginForm: {
                        username: '',
                        password: ''
                    },
                    selectedCategory: 'political_bias',
                    selectedModel: '',
                    currentQuestion: null,
                    aiResponse: null,
                    isLoading: false,
                    lastSystemUpdate: '',
                    totalTestsToday: 0,
                    // Real LLM status data
                    llmStatus: [],
                    redFlags: [],
                    // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                    biasCategories: [
                        { id: 'political_bias', name: 'Political Bias', icon: 'fas fa-vote-yea text-red-600', questionCount: 15 },
                        { id: 'gender_bias', name: 'Gender Bias', icon: 'fas fa-venus-mars text-pink-600', questionCount: 15 },
                        { id: 'racial_ethnic_bias', name: 'Racial/Ethnic Bias', icon: 'fas fa-users text-orange-600', questionCount: 15 },
                        { id: 'religious_bias', name: 'Religious Bias', icon: 'fas fa-pray text-purple-600', questionCount: 15 },
                        { id: 'economic_class_bias', name: 'Economic Class Bias', icon: 'fas fa-coins text-yellow-600', questionCount: 15 },
                        { id: 'lgbtq_rights', name: 'LGBTQ+ Rights', icon: 'fas fa-rainbow text-indigo-600', questionCount: 15 },
                        { id: 'age_bias', name: 'Age Bias', icon: 'fas fa-clock text-green-600', questionCount: 15 },
                        { id: 'disability_bias', name: 'Disability Bias', icon: 'fas fa-wheelchair text-blue-600', questionCount: 15 },
                        { id: 'cultural_national_bias', name: 'Cultural/National Bias', icon: 'fas fa-globe text-teal-600', questionCount: 15 },
                        { id: 'authoritarian_tendencies', name: 'Authoritarian Tendencies', icon: 'fas fa-gavel text-gray-600', questionCount: 15 }
                    ],
                    availableModels: [],
                    questions: []
                }
            },
            computed: {
                // API Base URL configuration
                API_BASE_URL() {
                    return 'http://localhost:8010';
                }
            },
            mounted() {
                this.checkAuthStatus();
                this.loadAvailableModels();
                this.loadQuestions();
                this.loadRandomQuestion();
                this.loadSystemStatus();
                this.loadLLMStatus();
                this.loadRedFlags();
                // Update data every 5 minutes
                setInterval(() => {
                    this.loadSystemStatus();
                    this.loadLLMStatus();
                    this.loadRedFlags();
                }, 300000);
            },
            methods: {
                async checkAuthStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/auth/status`);
                        if (response.ok) {
                            const data = await response.json();
                            this.isLoggedIn = data.authenticated;
                        }
                    } catch (error) {
                        console.error('Auth status check failed:', error);
                    }
                },
                async login() {
                    this.isLoggingIn = true;
                    this.loginError = '';
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/auth/login`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        const data = await response.json();
                        if (response.ok) {
                            this.isLoggedIn = true;
                            this.showLogin = false;
                            this.loginForm = { username: '', password: '' };
                            // Redirect to appropriate dashboard
                            if (data.role === 'admin') {
                                window.location.href = '/admin/';
                            } else {
                                window.location.href = '/bruker/';
                            }
                        } else {
                            this.loginError = data.message || 'Login failed';
                        }
                    } catch (error) {
                        this.loginError = 'Network error occurred';
                        console.error('Login error:', error);
                    } finally {
                        this.isLoggingIn = false;
                    }
                },
                async logout() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        await fetch(`${this.API_BASE_URL}/api/auth/logout`, { method: 'POST' });
                        this.isLoggedIn = false;
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                },
                async loadAvailableModels() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/models`);
                        if (response.ok) {
                            const data = await response.json();
                            this.availableModels = data.models || [];
                        }
                    } catch (error) {
                        console.error('Failed to load models:', error);
                    }
                },
                async loadQuestions() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/questions`);
                        if (response.ok) {
                            const data = await response.json();
                            this.questions = data.questions || [];
                        }
                    } catch (error) {
                        console.error('Failed to load questions:', error);
                    }
                },
                loadRandomQuestion() {
                    const categoryQuestions = this.questions.filter(q => q.category === this.selectedCategory);
                    if (categoryQuestions.length > 0) {
                        const randomIndex = Math.floor(Math.random() * categoryQuestions.length);
                        this.currentQuestion = categoryQuestions[randomIndex];
                    }
                },
                nextQuestion() {
                    this.loadRandomQuestion();
                    this.aiResponse = null;
                },
                getCurrentCategoryName() {
                    const category = this.biasCategories.find(c => c.id === this.selectedCategory);
                    return category ? category.name : 'Unknown Category';
                },
                async testQuestion() {
                    if (!this.selectedModel || !this.currentQuestion) return;
                    
                    this.isLoading = true;
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/test-bias`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                question_id: this.currentQuestion.id,
                                model_id: this.selectedModel,
                                question_text: this.currentQuestion.question
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.aiResponse = data;
                        } else {
                            console.error('Test failed:', response.statusText);
                        }
                    } catch (error) {
                        console.error('Test error:', error);
                    } finally {
                        this.isLoading = false;
                    }
                },
                getBiasScoreColor(score) {
                    if (score >= 80) return 'text-green-600';
                    if (score >= 60) return 'text-yellow-600';
                    return 'text-red-600';
                },
                async loadSystemStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/system-status`);
                        if (response.ok) {
                            const data = await response.json();
                            this.lastSystemUpdate = new Date(data.lastUpdate).toLocaleString();
                            this.totalTestsToday = data.testsToday || 0;
                        }
                    } catch (error) {
                        console.error('Failed to load system status:', error);
                    }
                },
                async loadLLMStatus() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/llm-status`);
                        if (response.ok) {
                            const data = await response.json();
                            this.llmStatus = data.models || [];
                        }
                    } catch (error) {
                        console.error('Failed to load LLM status:', error);
                    }
                },
                async loadRedFlags() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch(`${this.API_BASE_URL}/api/red-flags`);
                        if (response.ok) {
                            const data = await response.json();
                            this.redFlags = data.flags || [];
                        }
                    } catch (error) {
                        console.error('Failed to load red flags:', error);
                    }
                }
            },
            watch: {
                selectedCategory() {
                    this.loadRandomQuestion();
                    this.aiResponse = null;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
