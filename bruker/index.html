<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - AI Ethics Framework</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <i class="fas fa-user-shield text-2xl text-blue-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-gray-800">User Dashboard</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-600">Welcome, {{ user.username }}</span>
                        <button @click="logout" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div class="max-w-7xl mx-auto px-4 py-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">AI Bias Testing Dashboard</h2>
            
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-question-circle text-3xl text-blue-600 mr-4"></i>
                        <div>
                            <div class="text-2xl font-bold text-gray-800">{{ stats.totalQuestions }}</div>
                            <div class="text-sm text-gray-600">Questions Available</div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-robot text-3xl text-green-600 mr-4"></i>
                        <div>
                            <div class="text-2xl font-bold text-gray-800">{{ stats.totalModels }}</div>
                            <div class="text-sm text-gray-600">AI Models</div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-chart-bar text-3xl text-purple-600 mr-4"></i>
                        <div>
                            <div class="text-2xl font-bold text-gray-800">{{ stats.categoriesCount }}</div>
                            <div class="text-sm text-gray-600">Bias Categories</div>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-3xl text-orange-600 mr-4"></i>
                        <div>
                            <div class="text-2xl font-bold text-gray-800">{{ stats.testsRun }}</div>
                            <div class="text-sm text-gray-600">Tests Run Today</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bias Categories Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                <div v-for="category in biasCategories" :key="category.id" 
                     @click="selectedCategory = category.id"
                     :class="['cursor-pointer p-4 rounded-xl border-2 transition-all', 
                              selectedCategory === category.id ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300']">
                    <div class="text-center">
                        <i :class="['text-2xl mb-2', category.icon]"></i>
                        <h3 class="font-semibold text-sm">{{ category.name }}</h3>
                        <div class="text-xs text-gray-600 mt-1">{{ category.questionCount }} questions</div>
                    </div>
                </div>
            </div>

            <!-- Testing Interface -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-xl font-bold text-gray-800 mb-6">AI Bias Testing Interface</h3>
                
                <div v-if="currentQuestion" class="mb-6">
                    <div class="mb-4">
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded">
                            {{ getCurrentCategoryName() }}
                        </span>
                        <span class="ml-2 inline-block bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded">
                            {{ currentQuestion.difficulty }} difficulty
                        </span>
                    </div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">{{ currentQuestion.question }}</h4>
                    
                    <!-- Model Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select AI Model:</label>
                        <select v-model="selectedModel" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="">Choose an AI model to test...</option>
                            <option v-for="model in availableModels" :key="model.id" :value="model.id">
                                {{ model.provider }} - {{ model.name }}
                            </option>
                        </select>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between items-center">
                        <button @click="testQuestion" :disabled="!selectedModel || isLoading"
                                class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-semibold">
                            <i v-if="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
                            <i v-else class="fas fa-play mr-2"></i>
                            {{ isLoading ? 'Testing...' : 'Run Test' }}
                        </button>
                        <button @click="nextQuestion" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold">
                            <i class="fas fa-forward mr-2"></i>Next Question
                        </button>
                    </div>
                </div>

                <!-- Results -->
                <div v-if="testResult" class="mt-8 p-6 bg-gray-50 rounded-lg">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">Test Result</h4>
                    <div class="bg-white p-4 rounded-lg mb-4">
                        <p class="text-gray-800">{{ testResult.response }}</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <span class="font-semibold text-blue-800">Response Time:</span>
                            <div class="text-blue-600">{{ testResult.responseTime }}ms</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <span class="font-semibold text-green-800">Bias Score:</span>
                            <div class="text-green-600">{{ testResult.biasScore }}/10</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <span class="font-semibold text-purple-800">Analysis:</span>
                            <div class="text-purple-600">{{ testResult.analysis }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    user: { username: 'User' },
                    selectedCategory: 'political_bias',
                    selectedModel: '',
                    currentQuestion: null,
                    testResult: null,
                    isLoading: false,
                    stats: {
                        totalQuestions: 150,
                        totalModels: 4,
                        categoriesCount: 10,
                        testsRun: 0
                    },
                    // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                    biasCategories: [
                        { id: 'political_bias', name: 'Political Bias', icon: 'fas fa-vote-yea text-red-600', questionCount: 15 },
                        { id: 'gender_bias', name: 'Gender Bias', icon: 'fas fa-venus-mars text-pink-600', questionCount: 15 },
                        { id: 'racial_ethnic_bias', name: 'Racial/Ethnic Bias', icon: 'fas fa-users text-orange-600', questionCount: 15 },
                        { id: 'religious_bias', name: 'Religious Bias', icon: 'fas fa-pray text-purple-600', questionCount: 15 },
                        { id: 'economic_class_bias', name: 'Economic Class Bias', icon: 'fas fa-coins text-yellow-600', questionCount: 15 },
                        { id: 'lgbtq_rights', name: 'LGBTQ+ Rights', icon: 'fas fa-rainbow text-indigo-600', questionCount: 15 },
                        { id: 'age_bias', name: 'Age Bias', icon: 'fas fa-clock text-green-600', questionCount: 15 },
                        { id: 'disability_bias', name: 'Disability Bias', icon: 'fas fa-wheelchair text-blue-600', questionCount: 15 },
                        { id: 'cultural_national_bias', name: 'Cultural/National Bias', icon: 'fas fa-globe text-teal-600', questionCount: 15 },
                        { id: 'authoritarian_tendencies', name: 'Authoritarian Tendencies', icon: 'fas fa-gavel text-gray-600', questionCount: 15 }
                    ],
                    availableModels: [],
                    questions: []
                }
            },
            mounted() {
                this.checkAuth();
                this.loadData();
                this.loadRandomQuestion();
            },
            methods: {
                async checkAuth() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('/api/auth/status');
                        if (!response.ok) {
                            window.location.href = '/';
                            return;
                        }
                        const data = await response.json();
                        if (!data.authenticated) {
                            window.location.href = '/';
                        }
                        this.user = data.user || { username: 'User' };
                    } catch (error) {
                        console.error('Auth check failed:', error);
                        window.location.href = '/';
                    }
                },
                async logout() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        await fetch('/api/auth/logout', { method: 'POST' });
                        window.location.href = '/';
                    } catch (error) {
                        console.error('Logout error:', error);
                        window.location.href = '/';
                    }
                },
                async loadData() {
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const [modelsRes, questionsRes] = await Promise.all([
                            fetch('/api/available-models'),
                            fetch('/api/questions')
                        ]);
                        
                        if (modelsRes.ok) {
                            const modelsData = await modelsRes.json();
                            this.availableModels = modelsData.models || [];
                            this.stats.totalModels = this.availableModels.length;
                        }
                        
                        if (questionsRes.ok) {
                            const questionsData = await questionsRes.json();
                            this.questions = questionsData.questions || [];
                            this.stats.totalQuestions = this.questions.length;
                        }
                    } catch (error) {
                        console.error('Failed to load data:', error);
                    }
                },
                loadRandomQuestion() {
                    const categoryQuestions = this.questions.filter(q => q.category === this.selectedCategory);
                    if (categoryQuestions.length > 0) {
                        const randomIndex = Math.floor(Math.random() * categoryQuestions.length);
                        this.currentQuestion = categoryQuestions[randomIndex];
                    }
                },
                nextQuestion() {
                    this.loadRandomQuestion();
                    this.testResult = null;
                },
                getCurrentCategoryName() {
                    const category = this.biasCategories.find(c => c.id === this.selectedCategory);
                    return category ? category.name : 'Unknown Category';
                },
                async testQuestion() {
                    if (!this.selectedModel || !this.currentQuestion) return;
                    
                    this.isLoading = true;
                    try {
                        // üß∑ Dette skal v√¶re en fetch til FastAPI p√• port 8010, som svarer med JSON
                        const response = await fetch('/api/test-bias', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                question_id: this.currentQuestion.id,
                                model_id: this.selectedModel,
                                question_text: this.currentQuestion.question
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            this.testResult = data;
                            this.stats.testsRun++;
                        } else {
                            console.error('Test failed:', response.statusText);
                        }
                    } catch (error) {
                        console.error('Test error:', error);
                    } finally {
                        this.isLoading = false;
                    }
                }
            },
            watch: {
                selectedCategory() {
                    this.loadRandomQuestion();
                    this.testResult = null;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
